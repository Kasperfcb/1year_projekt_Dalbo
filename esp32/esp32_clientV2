import network
import socket
import time
import _thread as thread

ssid = "Skoletest"
password = "1234567891"
server_ip = "192.168.75.151"
server_port = 8000

client = None

def connect_to_wifi():
    wifi = network.WLAN(network.STA_IF)
    wifi.active(True)
    wifi.connect(ssid, password)

    while not wifi.isconnected():
        pass

    print('Connected to WiFi:', wifi.ifconfig())

def connect_to_server():
    global client

    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    client.connect((server_ip, server_port))
    print('Connected to server:', server_ip)

def send_data(message):
    client.sendall(message)
    print('Sent data:', message)

def disconnect_from_server():
    client.close()
    print('Disconnected from server.')

def format_time(seconds):
    hours = seconds // 3600
    minutes = (seconds % 3600) // 60
    seconds = seconds % 60
    return f"{hours:02d}:{minutes:02d}:{seconds:02d}"

def send_timer():
    while True:
        elapsed_time = time.time() - start_time
        formatted_time = format_time(elapsed_time)
        send_data(formatted_time.encode())
        time.sleep(1)  # Interval på 1 sekund

def run_client():
    connect_to_wifi()
    connect_to_server()

    global start_time
    start_time = time.time()

    # Start automatisk afsendelse af timer i en separat tråd
    thread.start_new_thread(send_timer, ())

    # Klienten kører nu automatisk og sender timeren i timer, minutter og sekunder

run_client()

